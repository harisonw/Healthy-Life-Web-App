<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HL</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
    <!-- Apple button, may remove -->
    <meta name="appleid-signin-client-id" content="[CLIENT_ID]" />
    <meta name="appleid-signin-scope" content="[SCOPES]" />
    <meta name="appleid-signin-redirect-uri" content="[REDIRECT_URI]" />
    <meta name="appleid-signin-state" content="[STATE]" />
    <meta name="appleid-signin-nonce" content="[NONCE]" />
    <link rel="icon" type="image/x-icon" href="/img/favicon-32x32.png" />
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html"
          ><img src="img/Healthy_Life-Logo-White.png" alt="HL Logo" height="40"
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="home.html">Home</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="profile.html"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Categories
              </a>
              <!-- Category Dropdown, Would be good to populate from database of all Categories-->
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="catagory.html">Category 1</a>
                </li>
                <li><a class="dropdown-item" href="#">Category 2</a></li>
                <li><a class="dropdown-item" href="#">Category 3</a></li>
                <li><a class="dropdown-item" href="#">Category 4</a></li>
                <li><a class="dropdown-item" href="#">Category 5</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="hlhacks.html"
                >HL Hacks</a
              >
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="profile.html"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Profile
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="profile.html">Profile</a>
                </li>
                <li>
                  <a class="dropdown-item" href="connections.html"
                    >Connections</a
                  >
                </li>
              </ul>
            </li>
          </ul>
          <!--- Only show if not signed in, else if logged in show logout button --->
          <a class="btn btn-primary ms-auto" href="login.html" role="button"
            >Login or Register</a
          >
          <a
            class="btn btn-primary ms-auto"
            href="login.html"
            hidden="hidden"
            role="button"
            >Logout</a
          >
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
      <!-- create a post section where users can upload images -->
      <div class="row">
        <div class="col-md-12 my-2">
          <div class="card">
            <div class="card-body">
              <form>
                <div class="mb-3">
                  <h1>Share a healthy life hack!</h1>
                  <label for="titleTextarea" class="form-label">Title:</label>
                  <textarea
                    class="form-control"
                    id="titleTextarea"
                    rows="1"
                  ></textarea>
                  <label for="postTextarea" class="form-label">Post:</label>
                  <textarea
                    class="form-control"
                    id="postTextarea"
                    rows="3"
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label for="formFile" class="form-label"
                    >Upload a Photo</label
                  >
                  <input class="form-control" type="file" id="formFile" />
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <button type="button" class="btn btn-primary">
                      Submit
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- end of create a post section -->
      <!-- display posts section -->
      <!-- make posts same size -->

      <div id="postRow" class="row">

      </div>
    </div>

    <script>
      function getPosts() {
        console.log("starting");
        // get posts from database
        var posts = fetch("http://localhost:3000/api/posts/get-all", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // reverse loop through posts and display them
            for (var i = data.length - 1; i >= 0; i--) {
              var post = data[i];
              var postRow = document.getElementById("postRow");
              var postCol = document.createElement("div");
              postCol.className = "col-md-4 my-2";
              var card = document.createElement("div");
              card.className = "card";
              var cardBody = document.createElement("div");
              cardBody.className = "card-body";
              var title = document.createElement("h5");
              title.className = "mx-2 mt-2";
              title.innerHTML = post.title;
              var description = document.createElement("p");
              description.className = "mx-2";
              description.innerHTML = post.body;
              var image = document.createElement("img");
              image.className = "img-fluid card-img-top";
              image.src = post.image;
              var likeButton = document.createElement("button");
              likeButton.className = "btn btn-primary mt-2 mx-2";
              likeButton.innerHTML = "Like <small>(" + post.likes.length + ")</small>";
              var time = document.createElement("p");
              time.className = "text-secondary mx-2";
              // calculate time since post
              var timeSince = new Date() - new Date(post.createdAt);
              timeSince = Math.floor(timeSince / 1000 / 60);
              if (timeSince < 60) {
                time.innerHTML = timeSince + " Minutes Ago";
              } else {
                timeSince = Math.floor(timeSince / 60);
                time.innerHTML = timeSince + " Hours Ago";
              }
              cardBody.appendChild(title);
              cardBody.appendChild(description);
              cardBody.appendChild(image);
              cardBody.appendChild(likeButton);
              cardBody.appendChild(time);
              card.appendChild(cardBody);
              postCol.appendChild(card);
              postRow.appendChild(postCol);
            }
          });

      };

      getPosts();
    </script>

    <!-- Footer -->
    <footer class="bg-dark text-center text-white mt-3">
      <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2)">
        Â© 2022 Copyright: Healthy Life
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
